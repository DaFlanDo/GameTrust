{% extends 'base.html' %}
{% block title %}–î–æ–±–∞–≤–∏—Ç—å –ª–æ—Ç ‚Äî GameMarket{% endblock %}

{% block content %}

<h1 class="text-2xl font-bold text-indigo-400 mb-8 text-center">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ª–æ—Ç</h1>

<form action="{{ url_for('lot.submit_lot') }}" method="POST" enctype="multipart/form-data" class="space-y-6 max-w-3xl mx-auto">

  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
  <div>
    <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input type="text" name="title" required
           class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white focus:ring-2 focus:ring-indigo-600">
  </div>

  <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è + –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <select name="category" required
              class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white">
        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
        <option value="Accounts">–ê–∫–∫–∞—É–Ω—Ç—ã</option>
        <option value="Keys">–ö–ª—é—á–∏</option>
        <option value="Currency">–í–∞–ª—é—Ç–∞</option>
        <option value="Services">–£—Å–ª—É–≥–∏</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
      <select name="platform" class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white">
        <option>PC</option>
        <option>PlayStation</option>
        <option>Xbox</option>
      </select>
    </div>
  </div>

  <!-- –ò–≥—Ä–∞ -->
  <div>
    <label class="block text-sm font-medium mb-1">–ò–≥—Ä–∞</label>
    <select name="game_id" id="gameSelect" required
            class="w-full px-4 py-2 pr-10 rounded bg-gray-800 border border-indigo-500 text-white appearance-none focus:ring-2 focus:ring-indigo-600">
      <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–Ω–∞—á–∞–ª–∞</option>
    </select>
  </div>

  <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
  <div>
    <label class="block text-sm font-medium mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
    <textarea name="description" rows="4"
              class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white focus:ring-2 focus:ring-indigo-600"
              placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –ª–æ—Ç..."></textarea>
  </div>

  <!-- –¶–µ–Ω–∞ + –ê–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞ -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium mb-1">–¶–µ–Ω–∞ (‚ÇΩ)</label>
      <input type="number" name="price" step="0.01" min="0"
             class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white focus:ring-2 focus:ring-indigo-600">
    </div>
    <div class="flex items-center gap-2 mt-7">
      <input type="checkbox" name="autodelivery" id="autodelivery"
             class="form-checkbox text-indigo-600 bg-gray-900 border-indigo-500 rounded">
      <label for="autodelivery" class="text-sm">‚ö° –ê–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞</label>
    </div>
  </div>

  <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ -->
  <div>
    <label class="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
    <input type="number" name="quantity" min="1" value="1"
           class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white focus:ring-2 focus:ring-indigo-600">
  </div>

  <!-- –î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∏ -->
  <div id="autodelivery-data-field" class="mt-4 hidden">
    <label class="block text-sm font-medium mb-1">–î–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≤—ã–¥–∞—á–∏ (–ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–∞ —Ç–æ–≤–∞—Ä)</label>
    <textarea name="autodelivery_data" rows="5"
              class="w-full px-4 py-2 rounded bg-gray-800 border border-indigo-500 text-white focus:ring-2 focus:ring-indigo-600"
              placeholder="login:pass\nlogin:pass\n–∫–ª—é—á –∏ —Ç.–¥..."></textarea>
  </div>

  <!-- –°–∫—Ä–∏–Ω—à–æ—Ç—ã -->
  <div class="space-y-2">
    <label class="block text-sm font-medium mb-1">–°–∫—Ä–∏–Ω—à–æ—Ç—ã (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
    <input type="file" id="images" name="images[]" accept="image/*" multiple hidden>
    <label for="images" class="inline-flex items-center gap-2 px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg cursor-pointer transition">
      üñº –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
    </label>
    <ul id="fileList" class="text-xs text-gray-400 space-y-1"></ul>
    <div id="preview" class="flex flex-wrap gap-3 mt-3"></div>
  </div>

  <div class="text-center pt-6">
    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-lg text-white font-medium shadow-md transition">
      ‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ª–æ—Ç
    </button>
  </div>
</form>

<script>
  // --- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ---
  document.querySelector('select[name="category"]').addEventListener('change', e => {
    const category = e.target.value;
    const gameSelect = document.getElementById('gameSelect');
    gameSelect.innerHTML = '<option disabled selected>–ó–∞–≥—Ä—É–∑–∫–∞...</option>';
    fetch(`/api/games?category=${encodeURIComponent(category)}`)
      .then(r => r.json())
      .then(data => {
        gameSelect.innerHTML = '';
        if (data.length) {
          data.forEach(g => {
            const opt = document.createElement('option');
            opt.value = g.id;
            opt.textContent = g.name;
            gameSelect.appendChild(opt);
          });
        } else {
          gameSelect.innerHTML = '<option disabled>–ù–µ—Ç –∏–≥—Ä –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
        }
      });
  });

  // --- –∞–≤—Ç–æ–¥–æ—Å—Ç–∞–≤–∫–∞: –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ ---
  function toggleAutoField(){
    const box = document.getElementById('autodelivery');
    document.getElementById('autodelivery-data-field').classList.toggle('hidden', !box.checked);
  }
  document.getElementById('autodelivery').addEventListener('change', toggleAutoField);

  // --- –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ---
  const input   = document.getElementById('images');
  const preview = document.getElementById('preview');
  const fileList= document.getElementById('fileList');

  input.addEventListener('change', () => {
    preview.innerHTML = '';
    fileList.innerHTML = '';
    Array.from(input.files).forEach(file => {
      // –ø—Ä–µ–≤—å—é
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'w-24 h-24 object-cover rounded border border-gray-700';
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
      // —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
      const li = document.createElement('li');
      li.textContent = `üìÅ ${file.name} (${(file.size/1024).toFixed(1)}¬†–ö–ë)`;
      fileList.appendChild(li);
    });
  });
</script>

{% endblock %}