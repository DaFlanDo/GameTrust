{% extends 'admin/admin_base.html' %}

{% block content %}
<h1 class="text-3xl font-bold text-white mb-8">–ü—Ä–æ—Ñ–∏–ª—å: {{ user.username }}</h1>

<div class="grid md:grid-cols-3 gap-6 mb-10">

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <div class="bg-dark p-6 rounded-xl shadow col-span-1">
    <div class="text-gray-400 mb-1">Email:</div>
    <div class="text-white font-semibold mb-4">{{ user.email }}</div>

    <div class="text-gray-400 mb-1">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</div>
    <div class="text-white font-semibold mb-4">
      {{ user.created_at.strftime('%d.%m.%Y') if user.created_at else '‚Äî' }}
    </div>

    <div class="text-gray-400 mb-1">–°—Ç–∞—Ç—É—Å:</div>
    <div class="mb-4">
      {% if user.is_blocked %}
        <span class="text-red-500 font-bold">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
      {% else %}
        <span class="text-green-500 font-bold">–ê–∫—Ç–∏–≤–µ–Ω</span>
      {% endif %}
    </div>

    <div class="flex gap-2 mt-6">
      <form method="post"
        action="{{ url_for('admin.edit_user', user_id=user.id) }}?action=toggle_block"
        class="flex flex-col gap-2 md:w-64 w-full">

    {% if not user.is_blocked %}
      <label class="text-sm text-gray-300">–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
        <select name="block_reason"
                class="mt-1 bg-gray-800 text-white px-4 py-2 rounded border border-gray-700 focus:outline-none focus:ring-2 focus:ring-yellow-400 w-full">
          <option value="–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª">–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª</option>
          <option value="–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å">–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
          <option value="–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ">–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</option>
          <option value="–ü—Ä–æ—á–µ–µ">–ü—Ä–æ—á–µ–µ</option>
        </select>
      </label>
    {% endif %}

    <button type="submit"
            class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-5 py-2 rounded shadow-md transition">
      {% if user.is_blocked %} –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å {% else %} –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å {% endif %}
    </button>
  </form>

    <form method="post"
        action="{{ url_for('admin.edit_user', user_id=user.id, action='delete') }}"
        onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
    <button type="submit"
            class="w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2 rounded shadow-md transition">
      –£–¥–∞–ª–∏—Ç—å
    </button>
  </form>
    </div>
  </div>

  <!-- –ë–∞–ª–∞–Ω—Å -->
  <div class="bg-dark p-6 rounded-xl shadow col-span-2">
    <form method="post" class="grid gap-4 max-w-xl">
      <label class="text-sm text-gray-400">–ë–∞–ª–∞–Ω—Å:
        <input type="number" name="balance" value="{{ user.balance }}"
               class="w-full px-4 py-2 bg-gray-800 text-white rounded mt-1">
      </label>

      <label class="text-sm text-gray-400">–•–æ–ª–¥-–±–∞–ª–∞–Ω—Å:
        <input type="number" name="hold_balance" value="{{ user.hold_balance }}"
               class="w-full px-4 py-2 bg-gray-800 text-white rounded mt-1">
      </label>

      <button class="bg-accent px-4 py-2 rounded text-white mt-2">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
  </div>
</div>

<hr class="my-8 border-gray-700">

<h2 class="text-xl font-bold text-white mb-4">–õ–æ—Ç—ã</h2>
<table class="w-full text-left bg-dark rounded-xl shadow overflow-hidden mb-10">
  <thead class="bg-gray-800 text-gray-400 text-sm uppercase">
    <tr>
      <th class="px-4 py-3">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <th class="px-4 py-3">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th class="px-4 py-3">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
      <th class="px-4 py-3">–¶–µ–Ω–∞</th>
      <th class="px-4 py-3">–ü—Ä–æ–¥–∞–∂</th>
      <th class="px-4 py-3">–°—Ç–∞—Ç—É—Å</th>
    </tr>
  </thead>
  <tbody class="text-gray-300">
    {% for lot in lots %}
    <tr class="border-t border-gray-700 hover:bg-gray-800">
      <td class="px-4 py-3">
        <a href="/lot/{{ lot.id }}" class="text-accent hover:underline">{{ lot.title }}</a>
      </td>
      <td class="px-4 py-3">{{ lot.category }}</td>
      <td class="px-4 py-3">{{ lot.platform }}</td>
      <td class="px-4 py-3">{{ lot.price }} ‚ÇΩ</td>
      <td class="px-4 py-3">{{ sales_by_lot[lot.id] }}</td>
      <td class="px-4 py-3">{{ '‚úÖ' if lot.is_active else '‚ùå' }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- –ü–æ–∫—É–ø–∫–∏ -->
<h2 class="text-xl font-bold text-white mb-4">–ü–æ–∫—É–ø–∫–∏</h2>
<table class="w-full text-left bg-dark rounded-xl shadow overflow-hidden">
  <thead class="bg-gray-800 text-gray-400 text-sm uppercase">
    <tr>
      <th class="px-4 py-3">–õ–æ—Ç</th>
      <th class="px-4 py-3">–¶–µ–Ω–∞</th>
      <th class="px-4 py-3">–ü—Ä–æ–¥–∞–≤–µ—Ü</th>
      <th class="px-4 py-3">–î–∞—Ç–∞</th>
      <th class="px-4 py-3">–°—Ç–∞—Ç—É—Å</th>
    </tr>
  </thead>
  <tbody class="text-gray-300">
    {% for p in purchases %}
    <tr class="border-t border-gray-700 hover:bg-gray-800">
      <td class="px-4 py-3">{{ p.lot_title }}</td>
      <td class="px-4 py-3">{{ p.lot_price }} ‚ÇΩ</td>
      <td class="px-4 py-3">{{ p.seller_username }}</td>
      <td class="px-4 py-3">{{ p.created_at.strftime('%d.%m.%Y') }}</td>
      <td class="px-4 py-3">{{ p.status }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
    <h2 class="text-xl font-bold text-white mb-4">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
<table class="w-full text-left bg-dark rounded-xl shadow overflow-hidden mb-10">
  <thead class="bg-gray-800 text-gray-400 text-sm uppercase">
    <tr>
      <th class="px-4 py-3">–¢–∏–ø</th>
      <th class="px-4 py-3">–°—É–º–º–∞</th>
      <th class="px-4 py-3">–°—Ç–∞—Ç—É—Å</th>
      <th class="px-4 py-3">–û–ø–∏—Å–∞–Ω–∏–µ</th>
      <th class="px-4 py-3">–î–∞—Ç–∞</th>
    </tr>
  </thead>
  <tbody class="text-gray-300">
    {% for t in transactions %}
    <tr class="border-t border-gray-700 hover:bg-gray-800">
      <td class="px-4 py-3">{{ t.type }}</td>
      <td class="px-4 py-3">{{ t.amount }} ‚ÇΩ</td>
      <td class="px-4 py-3">{{ t.status }}</td>
      <td class="px-4 py-3">{{ t.description or '‚Äî' }}</td>
      <td class="px-4 py-3">{{ t.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
    <h2 class="text-xl font-bold text-white mb-4">–ü—Ä–æ–¥–∞–∂–∏</h2>
<table class="w-full text-left bg-dark rounded-xl shadow overflow-hidden mb-10">
  <thead class="bg-gray-800 text-gray-400 text-sm uppercase">
    <tr>
      <th class="px-4 py-3">–õ–æ—Ç</th>
      <th class="px-4 py-3">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
      <th class="px-4 py-3">–°—É–º–º–∞</th>
      <th class="px-4 py-3">–î–∞—Ç–∞</th>
      <th class="px-4 py-3">–°—Ç–∞—Ç—É—Å</th>
    </tr>
  </thead>
  <tbody class="text-gray-300">
    {% for s in sales %}
    <tr class="border-t border-gray-700 hover:bg-gray-800">
      <td class="px-4 py-3">{{ s.lot_title }}</td>
      <td class="px-4 py-3">{{ s.reviewer.username if s.reviewer else '‚Äî' }}</td>
      <td class="px-4 py-3">{{ s.lot_price }} ‚ÇΩ</td>
      <td class="px-4 py-3">{{ s.created_at.strftime('%d.%m.%Y') }}</td>
      <td class="px-4 py-3">{{ s.status }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}